{% extends "base.html" %}

{% block content %}
<h2 class="mb-4">Post a New Job</h2>

<form id="postJobForm">
    {% csrf_token %}
    <div class="mb-3">
        <label for="title" class="form-label">Job Title</label>
        <input type="text" class="form-control" id="title" name="title" required>
    </div>
    <div class="mb-3">
        <label for="company" class="form-label">Company Name</label>
        <input type="text" class="form-control" id="company" name="company" required>
    </div>
    <div class="mb-3">
        <label for="location" class="form-label">Location</label>
        <input type="text" class="form-control" id="location" name="location" required>
    </div>
    <div class="mb-3">
        <label for="description" class="form-label">Job Description</label>
        <textarea class="form-control" id="description" name="description" rows="5" required></textarea>
    </div>
    <button type="submit" class="btn btn-success">Post Job</button>
</form>

<div id="message" class="mt-3"></div>

<script>
document.getElementById('postJobForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    const data = {
        title: document.getElementById('title').value,
        company: document.getElementById('company').value,
        location: document.getElementById('location').value,
        description: document.getElementById('description').value
    };

    fetch("{% url 'api_post_job' %}", {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        document.getElementById('message').innerText = result.message;
        document.getElementById('postJobForm').reset();
    })
    .catch(error => {
        document.getElementById('message').innerText = 'Error posting job.';
        console.error(error);
    });
});
</script>
{% endblock %}
